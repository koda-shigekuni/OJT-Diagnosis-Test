## AI駆動開発ガイドライン（React×TypeScript×Express）

---

### 🧭 基本理念
- コードは**正しく動くだけでなく、読みやすく・保守しやすく・安全であること**を重視する。  
- フロント・バックを問わず「実装の速さ」よりも「品質と再現性」を優先。  
- 問題を放置せず、根本原因を特定・記録・共有する。  
- 常に「来た時よりも綺麗に」するボーイスカウトルールを適用。
- 常に回答は日本語で簡潔に返答する。
---

### ⚙️ フロントエンド（React 19.1 + TypeScript）
#### コーディング規約
- **`React.FC` は使用禁止。** 必ず `const Component = (props: Props): JSX.Element => {}` の形式で定義。  
- `useState`, `useEffect`, `useMemo`, `useCallback` などのReact Hooksを正しく分離・最小化する。  
- イベントハンドラは明示的に型を指定し、暗黙的なanyは禁止。  
- JSX内では三項演算子・ロジックを最小限にし、処理は外部関数化。  
- 再利用可能なUI要素は`/components`配下に切り出す。

#### スタイリング
- Emotion + MUI（v7.1.0）を標準採用。  
- Emotionの `styled` または MUI の `sx` を使用し、**グローバルCSSは禁止**。  
- カラーパレット・タイポグラフィは `theme.ts` に一元管理。  
- レイアウト構造は `Grid` や `Box` コンポーネントを優先的に使用。  

#### パフォーマンス・信頼性
- コンポーネントの再レンダーを`React.memo`または`useMemo`で制御。  
- Lazy/Suspenseで遅延ロードを活用。  
- 外部API通信は`try/catch`で明示的にハンドリング。  
- `ErrorBoundary`を必ずアプリケーションルートに配置。

---

### 🧩 バックエンド（Express 5.1.0 + TypeScript）
#### 設計原則
- すべてのルートは `async/await` ベースで記述。  
- 型定義は`@types/express`準拠で厳格に管理し、`any`は禁止。  
- APIの入出力は共通のDTOスキーマで統一（例: `zod` または `class-validator`）。  
- ビジネスロジックはController層に集中させ、Routeではロジックを記述しない。  

#### エラーハンドリング
- 例外は共通エラーハンドラで処理し、明示的なエラーレスポンス（JSON形式）を返す。  
- `@ts-ignore`や`try { ... } catch {}` の握りつぶしは禁止。  
- 外部API、DB、ファイル操作すべてにタイムアウト設定を適用。  

#### セキュリティ
- 環境変数でAPIキー・DB認証情報を管理。  
- SQLインジェクション防止のため、必ずプレースホルダを使用。  
- Helmet, CORS, RateLimit を導入し、最小限の権限で稼働。  
- ログには個人情報を含めない。

---

### 🗃 データベース（MySQL 3.9）
- ORMは使用可。ただし生成クエリを必ずレビューし、N+1問題を防止。  
- 外部キー制約とインデックス設計を明確化。  
- DBスキーマ変更は`migration`フォルダで履歴管理。  
- トランザクション単位を小さく保ち、例外時は確実にロールバック。  

---

### 🧪 テストと品質保証
- Jest / Vitest による単体テストを標準化。  
- 重要な機能は E2E テスト（Playwright推奨）で確認。  
- テストは「実装詳細」ではなく「動作（入出力）」を検証。  
- カバレッジは参考値とし、テストの有効性を重視。  
- 失敗を無視する`test.skip`は禁止。

---

### 🔁 保守性とリファクタリング
- 新機能追加時は、既存コードの改善を並行実施。  
- 未使用コード・importは積極的に削除。  
- `eslint`, `prettier` をCIに組み込み、自動整形を徹底。  
- 技術的負債は`// TODO:`コメントやIssueで明示的に残す。

---

### 🔒 セキュリティ・信頼性
- すべての外部入力を検証。  
- 依存パッケージは定期的に更新し、CVEレポートを監視。  
- リトライ・バックオフ・サーキットブレーカーをAPI呼び出しに実装。  
- ログ出力は構造化し、可観測性を重視（例: pino, winston）。  

---

### 🧰 Git運用
- コンベンショナルコミットを採用（`feat:`, `fix:`, `chore:` 等）。  
- コミットは1つの論理変更に限定。  
- main/masterブランチへの直接コミット禁止。  
- PRには概要・理由・影響範囲を必ず記述。

---

### 💬 コードレビュー方針
- 批判ではなく改善提案としてコメントする。  
- コードの品質・安全性・意図を優先的に確認。  
- レビュー指摘は共有知識としてWiki等に反映。

---

### 🧠 ドキュメント・ナレッジ共有
- `README.md`にセットアップ、構成、起動方法を明記。  
- 設計上の意思決定は`/docs/ADR/`配下で管理。  
- 新規APIやUI仕様はSwagger / Storybookで同期更新。  
- 学びや改善は定期的にドキュメント化し、AI支援開発の精度を向上。

---

### 🔄 継続的改善
- 定期的に開発プロセスを振り返り、改善を提案。  
- 新技術は安定性・保守性・チームスキルを踏まえて採用。  
- 全員が「次の開発者が理解できるコード」を意識する。  

---

### ✅ 適用範囲
このガイドラインは、当リポジトリ配下（フロントエンド／バックエンド／DB設計を含む）全体に適用される。  
サブディレクトリに別途 `AGENTS.md` が存在する場合は、そちらが優先される。  
